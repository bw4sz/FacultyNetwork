---
title: "FacultyNetworks"
author: "Ben Weinstein"
date: "Saturday, November 01, 2014"
output:
  html_document:
    toc: true
    number_sections: true
---

#Aim

Using tools from network ecology, we can begin to examine patterns of colloboration, specialization and compartamentalisation within academic departments. Using journal publications as a metric of similiarity among faculty members, we can compare the relative specialization of each department and compare academic niche breadth as a function of size, location and other measures of group interactions. I will begin with departments in Ecology and Evolution.

#Approach

1. Get list of journals with subheadings and disciplines from google to create similarity lists.
2. Get names of top academic departments in the US with a program in Ecology and Evolution.
3. Search the pubmed archives for journal title and affiliation.
4. Decompose API results into R metadata.
5. Perform network analysis on academic departments as a function of similarity in journal publications.

```{r,echo=F,warning=FALSE,message=FALSE}
#load libraries
library(XML)
library(stringr)
library(RCurl)
library(wordcloud)
library(tm)
library(reshape2)
library(sna)
library(bipartite)
library(dplyr)
library(stringr)
library(knitr)
library(rentrez)
opts_chunk$set(fig.width=10,cache=TRUE,warning=F,message=F,echo=F)
```

# List of journals and disciplines

Scrape the subcategory data from google scholar page, not the search engine, they don't allow that!
[Link](http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio)

```{r,eval=FALSE}
URLS<-c(
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_agronomycropscience",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_animalbehavior",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_animalhusbandry",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_atmosphericsciences",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_biochemistry",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_biodiversityconservationbiology",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_bioinformatics",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_biophysics",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_biotechnology",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_birds",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_botany",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_cellbiology",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_developmentalbiologyembryology",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_ecology",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_environmentalgeologicalengineering",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_environmentalsciences",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_evolutionarybiology",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_foodsciencetechnology",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_forestsforestry",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_geochemistrymineralogy",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_geology",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_hydrology",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_insectsarthropods",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_biogeneral",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_marinesciencesfisheries",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_microbiology",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_molecularbiology",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_mycology",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_oceanography",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_paleontology",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_pestcontrolpesticides",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_plantpathology",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_proteomicspeptides",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_soilsciences",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_sustainabledevelopment",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_sustainableenergy",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_virology",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_woodsciencetechnology",
  "http://scholar.google.com/citations?view_op=top_venues&hl=en&vq=bio_zoology")


.simpleCap <- function(x) {
  s <- strsplit(x, " ")[[1]]
  paste(toupper(substring(s, 1, 1)), substring(s, 2),
        sep = "", collapse = " ")
}

#Get journal classification
out<-list()

for (x in 1:length(URLS)){
  nam<-str_match(URLS[x],"bio_(\\w+)")[2]
  xtab= readHTMLTable(URLS[x], header=T, which=1,stringsAsFactors=F)[,-1]
  out[[x]]<-data.frame(Class=.simpleCap(nam),xtab)
}

j_class<-rbind_all(out)
head(j_class)

jc<-as.data.frame(table(j_class$Class))
colnames(jc)<-c("Category","N")

write.csv(j_class,"Class.csv")
```

```{r}
#If reading in from file.
j_class<-read.csv("Class.csv")
jc<-as.data.frame(table(j_class$Class))
colnames(jc)<-c("Category","N")
kable(jc)
```


#Lists of Academic Departments

Scraping from [here](http://www.nescent.org/eog/graduateprogdatabase.php?orderby=PhD&order=asc)

125 Departments in the US.

```{r,eval=FALSE}
xtab= readHTMLTable("http://www.nescent.org/eog/graduateprogdatabase.php?orderby=PhD&order=asc", header=T, which=1,stringsAsFactors=F)[,-1]
depts<-xtab[,-c(5,6)]
write.csv(depts,"depts.csv")
```

```{r}
#If reading in from file
depts<-read.csv("depts.csv")
kable(head(depts))
```

#Associate faculty with a given department

I could either do this by scraping individual faculty pages (hard) or using crossref to better describe affilication.

#Search pubmed (scopus?) for articles

Let's begin slowly. I want to search an affiliation for any of the journal titles i have in my categories. I found the rentrez package (thanks RopenSCI!) and i want to give it a try. 

```{r}
katipo <- "Stony+Brook[affiliation]"
katipo_search <- entrez_search(db="pubmed", term=katipo)
doc <- entrez_fetch(db="pubmed", id=katipo_search$ids, rettype="xml")
f<-xmlToList(doc)

#Journal
article_journal<-sapply(f,function(x){
  x$MedlineCitation$Article$Journal$Title
})

#Institution
article_affiliation<-sapply(f,function(x){
x$MedlineCitation$Article$AuthorList$Author$AffiliationInfo$Affiliation
})

```

A couple annoying things i've found so far

* Pubmed just gives first author affiliation.
* The coverage of ecology of journals is weak.

# Create network

* Associate each journal article with a faculty member, then a department. Use the categories from step 1 to describe each faculty member as to which discipline they fall into. 

# Network analysis

It would be interesting to look at a number of ideas.

Within each department.

* Degree of niche overlap and compartmentalization in departments. How similiar are faculty members? 

* Forbidden links: are there certain kinds of people which are never in the same faculty, this could highlight areas of potential growth. Like wood science and evolutionary biology. Test co-occurrence rates against a null model of richness and find which combinations occur less often then chance.

* I could build a interesting little shiny server which shows a network and allows people to add themselves into each department. Great for a job talk.

* Specialization compared to the overall pool of researchers. Where do we see aggregations of like-minded scientists? Does chicago really have more theoriticians than elsewhere? 
